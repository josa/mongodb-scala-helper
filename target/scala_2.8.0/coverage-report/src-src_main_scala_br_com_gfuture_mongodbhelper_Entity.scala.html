<table class="classes"><tbody><tr>
      <td class="barContainerLeft"><a href="#">&#x200B;br/&#x200B;com/&#x200B;gfuture/&#x200B;mongodbhelper/<span class="header">&#x200B;Entity.scala</span></a></td>
      <td class="barContainerRight"><div class="percentages">
      <div class="bar">
        <div class="percentage">94 %</div>
        <div class="greenBar" style="width:188px;">&nbsp;</div>
      </div>
    </div></td>
    </tr><tr>
      <td class="barContainerLeft"><a href="src-src_main_scala_br_com_gfuture_mongodbhelper_Entity.scala.html#Object_br_com_gfuture_mongodbhelper_Entity"><img src="object.png"></img>Entity</a></td>
      <td class="barContainerRight"><div class="percentages">
      <div class="bar">
        <div class="percentage">100 %</div>
        <div class="greenBar" style="width:200px;">&nbsp;</div>
      </div>
    </div></td>
    </tr><tr>
      <td class="barContainerLeft"><a href="src-src_main_scala_br_com_gfuture_mongodbhelper_Entity.scala.html#Trait_br_com_gfuture_mongodbhelper_Entity"><img src="trait.png"></img>Entity</a></td>
      <td class="barContainerRight"><div class="percentages">
      <div class="bar">
        <div class="percentage">75 %</div>
        <div class="greenBar" style="width:150px;">&nbsp;</div>
      </div>
    </div></td>
    </tr></tbody></table><table class="source"><tbody><tr>
            <td class="black">1</td>
            <td>package br.com.gfuture.mongodbhelper
</td>
          </tr><tr>
            <td class="black">2</td>
            <td>
</td>
          </tr><tr>
            <td class="black">3</td>
            <td>import java.lang.reflect.Field
</td>
          </tr><tr>
            <td class="black">4</td>
            <td>import com.mongodb.{DBCollection, DBObject}
</td>
          </tr><tr>
            <td class="black">5</td>
            <td>
</td>
          </tr><tr>
            <td class="black">6</td>
            <td>import com.mongodb.casbah.commons.MongoDBObject
</td>
          </tr><tr>
            <td class="black">7</td>
            <td>import mongodb.MongoProvider
</td>
          </tr><tr>
            <td class="black">8</td>
            <td>import org.bson.types.ObjectId
</td>
          </tr><tr>
            <td class="black">9</td>
            <td>
</td>
          </tr><tr>
            <td class="black">10</td>
            <td><a id="Trait_br_com_gfuture_mongodbhelper_Entity"></a>trait Entity {
</td>
          </tr><tr>
            <td class="black">11</td>
            <td>
</td>
          </tr><tr>
            <td class="green">12</td>
            <td>  var _id: org.bson.types.ObjectId = null
</td>
          </tr><tr>
            <td class="black">13</td>
            <td>
</td>
          </tr><tr>
            <td class="green">14</td>
            <td>  protected val transientFields = scala.collection.mutable.Set.empty[String]
</td>
          </tr><tr>
            <td class="black">15</td>
            <td>
</td>
          </tr><tr>
            <td class="green">16</td>
            <td>  def getObjectId: org.bson.types.ObjectId = this._id
</td>
          </tr><tr>
            <td class="black">17</td>
            <td>
</td>
          </tr><tr>
            <td class="green">18</td>
            <td>  def save = Entity.save(this)
</td>
          </tr><tr>
            <td class="black">19</td>
            <td>
</td>
          </tr><tr>
            <td class="green">20</td>
            <td>  def delete = Entity.delete(this)
</td>
          </tr><tr>
            <td class="black">21</td>
            <td>
</td>
          </tr><tr>
            <td class="green">22</td>
            <td>  def getTransientFields = this.transientFields
</td>
          </tr><tr>
            <td class="black">23</td>
            <td>
</td>
          </tr><tr>
            <td class="red">24</td>
            <td>  override def equals(that: Any) = <span class="non">that match {
</span></td>
          </tr><tr>
            <td class="red">25</td>
            <td>    case _ =&gt; <span class="non">throw new RuntimeException(getClass.getName + &quot;, é obrigatório implementar o método equals&quot;)
</span></td>
          </tr><tr>
            <td class="black">26</td>
            <td>  }
</td>
          </tr><tr>
            <td class="black">27</td>
            <td>
</td>
          </tr><tr>
            <td class="black">28</td>
            <td>}
</td>
          </tr><tr>
            <td class="black">29</td>
            <td>
</td>
          </tr><tr>
            <td class="black">30</td>
            <td><a id="Object_br_com_gfuture_mongodbhelper_Entity"></a>object Entity {
</td>
          </tr><tr>
            <td class="black">31</td>
            <td>
</td>
          </tr><tr>
            <td class="black">32</td>
            <td>  /**
</td>
          </tr><tr>
            <td class="black">33</td>
            <td>   * Cria uma instancia de uma entidade
</td>
          </tr><tr>
            <td class="black">34</td>
            <td>   *
</td>
          </tr><tr>
            <td class="black">35</td>
            <td>   * @param dbObject, o &quot;json&quot; do mongodb
</td>
          </tr><tr>
            <td class="black">36</td>
            <td>   * @param entityClass, a tipo que será criado
</td>
          </tr><tr>
            <td class="black">37</td>
            <td>   */
</td>
          </tr><tr>
            <td class="green">38</td>
            <td>  def create[T &lt;: Entity](dbObject: DBObject, entityClass: Class[T]): T = dbObject match {
</td>
          </tr><tr>
            <td class="black">39</td>
            <td>    case dbObjectMatch: Any =&gt;
</td>
          </tr><tr>
            <td class="green">40</td>
            <td>      val entity: T = entityClass.newInstance
</td>
          </tr><tr>
            <td class="green">41</td>
            <td>      loadFieldsRecursively(entityClass).foreach {
</td>
          </tr><tr>
            <td class="black">42</td>
            <td>        field =&gt;
</td>
          </tr><tr>
            <td class="green">43</td>
            <td>          Entity.validatePersistenteField(entity, field) match {
</td>
          </tr><tr>
            <td class="black">44</td>
            <td>            case true =&gt;
</td>
          </tr><tr>
            <td class="green">45</td>
            <td>              field.setAccessible(true)
</td>
          </tr><tr>
            <td class="green">46</td>
            <td>              field.set(entity, dbObjectMatch.get(field.getName))
</td>
          </tr><tr>
            <td class="black">47</td>
            <td>            case false =&gt;
</td>
          </tr><tr>
            <td class="black">48</td>
            <td>          }
</td>
          </tr><tr>
            <td class="black">49</td>
            <td>      }
</td>
          </tr><tr>
            <td class="green">50</td>
            <td>      entity
</td>
          </tr><tr>
            <td class="black">51</td>
            <td>    case _ =&gt;
</td>
          </tr><tr>
            <td class="green">52</td>
            <td>      null.asInstanceOf[T]
</td>
          </tr><tr>
            <td class="black">53</td>
            <td>  }
</td>
          </tr><tr>
            <td class="black">54</td>
            <td>
</td>
          </tr><tr>
            <td class="black">55</td>
            <td>  def save[T &lt;: Entity](entity: T) {
</td>
          </tr><tr>
            <td class="green">56</td>
            <td>    entity._id = save(toMongoObject(entity), entity.getClass.getSimpleName.toLowerCase)
</td>
          </tr><tr>
            <td class="black">57</td>
            <td>  }
</td>
          </tr><tr>
            <td class="black">58</td>
            <td>
</td>
          </tr><tr>
            <td class="black">59</td>
            <td>  /**Salva o dbObject no mongodb
</td>
          </tr><tr>
            <td class="black">60</td>
            <td>   *
</td>
          </tr><tr>
            <td class="black">61</td>
            <td>   * @param o dbObject
</td>
          </tr><tr>
            <td class="black">62</td>
            <td>   */
</td>
          </tr><tr>
            <td class="black">63</td>
            <td>  def save[T &lt;: Entity](dbObject: DBObject, collectionName: String): ObjectId = {
</td>
          </tr><tr>
            <td class="green">64</td>
            <td>    val bCollection: DBCollection = MongoProvider.getCollection(collectionName)
</td>
          </tr><tr>
            <td class="green">65</td>
            <td>    bCollection.save(dbObject)
</td>
          </tr><tr>
            <td class="green">66</td>
            <td>    dbObject.get(&quot;_id&quot;).asInstanceOf[org.bson.types.ObjectId]
</td>
          </tr><tr>
            <td class="black">67</td>
            <td>  }
</td>
          </tr><tr>
            <td class="black">68</td>
            <td>
</td>
          </tr><tr>
            <td class="black">69</td>
            <td>  /**
</td>
          </tr><tr>
            <td class="black">70</td>
            <td>   * Exclui a entidade do mongodb
</td>
          </tr><tr>
            <td class="black">71</td>
            <td>   *
</td>
          </tr><tr>
            <td class="black">72</td>
            <td>   * @param a entidade
</td>
          </tr><tr>
            <td class="black">73</td>
            <td>   * @return voids
</td>
          </tr><tr>
            <td class="black">74</td>
            <td>   */
</td>
          </tr><tr>
            <td class="black">75</td>
            <td>  def delete[T &lt;: Entity](entity: T) {
</td>
          </tr><tr>
            <td class="green">76</td>
            <td>    delete(entity._id, entity.getClass.getSimpleName.toLowerCase)
</td>
          </tr><tr>
            <td class="black">77</td>
            <td>  }
</td>
          </tr><tr>
            <td class="black">78</td>
            <td>
</td>
          </tr><tr>
            <td class="black">79</td>
            <td>  /**
</td>
          </tr><tr>
            <td class="black">80</td>
            <td>   * Exclui a entidade pelo objectId
</td>
          </tr><tr>
            <td class="black">81</td>
            <td>   *
</td>
          </tr><tr>
            <td class="black">82</td>
            <td>   * @param o objectId, identificador único do documento
</td>
          </tr><tr>
            <td class="black">83</td>
            <td>   * @return void
</td>
          </tr><tr>
            <td class="black">84</td>
            <td>   */
</td>
          </tr><tr>
            <td class="black">85</td>
            <td>  def delete(objectId: org.bson.types.ObjectId, collectionName: String) {
</td>
          </tr><tr>
            <td class="green">86</td>
            <td>    MongoProvider.getCollection(collectionName).remove(toMongoObject(objectId))
</td>
          </tr><tr>
            <td class="black">87</td>
            <td>  }
</td>
          </tr><tr>
            <td class="black">88</td>
            <td>
</td>
          </tr><tr>
            <td class="black">89</td>
            <td>  /**
</td>
          </tr><tr>
            <td class="black">90</td>
            <td>   * Converte o _id em um objeto de persistencia do mongo
</td>
          </tr><tr>
            <td class="black">91</td>
            <td>   *
</td>
          </tr><tr>
            <td class="black">92</td>
            <td>   * @param _id, instancia da classe org.bson.types.ObjectId
</td>
          </tr><tr>
            <td class="black">93</td>
            <td>   * @return uma instancia da classe com.mongodb.DBObject
</td>
          </tr><tr>
            <td class="black">94</td>
            <td>   */
</td>
          </tr><tr>
            <td class="black">95</td>
            <td>  def toMongoObject[T &lt;: Entity](objectId: org.bson.types.ObjectId): DBObject = {
</td>
          </tr><tr>
            <td class="green">96</td>
            <td>    MongoDBObject(&quot;_id&quot; -&gt; objectId)
</td>
          </tr><tr>
            <td class="black">97</td>
            <td>  }
</td>
          </tr><tr>
            <td class="black">98</td>
            <td>
</td>
          </tr><tr>
            <td class="black">99</td>
            <td>  /**Converte o objeto em um objeto de persistencia do mongo
</td>
          </tr><tr>
            <td class="black">100</td>
            <td>   *
</td>
          </tr><tr>
            <td class="black">101</td>
            <td>   * @param entity, a entidade a ser convertida
</td>
          </tr><tr>
            <td class="black">102</td>
            <td>   * @return uma instancia da classe com.mongodb.DBObject
</td>
          </tr><tr>
            <td class="black">103</td>
            <td>   */
</td>
          </tr><tr>
            <td class="black">104</td>
            <td>  def toMongoObject[T &lt;: Entity](entity: T): DBObject = {
</td>
          </tr><tr>
            <td class="green">105</td>
            <td>    val builder = MongoDBObject.newBuilder
</td>
          </tr><tr>
            <td class="green">106</td>
            <td>    builder += &quot;_id&quot; -&gt; entity.getObjectId
</td>
          </tr><tr>
            <td class="green">107</td>
            <td>    loadFieldsRecursively(entity.getClass).foreach {
</td>
          </tr><tr>
            <td class="black">108</td>
            <td>      field =&gt;
</td>
          </tr><tr>
            <td class="green">109</td>
            <td>        Entity.validatePersistenteField(entity, field) match {
</td>
          </tr><tr>
            <td class="black">110</td>
            <td>          case true =&gt;
</td>
          </tr><tr>
            <td class="green">111</td>
            <td>            field.setAccessible(true)
</td>
          </tr><tr>
            <td class="green">112</td>
            <td>            builder += field.getName -&gt; field.get(entity)
</td>
          </tr><tr>
            <td class="black">113</td>
            <td>          case false =&gt;
</td>
          </tr><tr>
            <td class="black">114</td>
            <td>        }
</td>
          </tr><tr>
            <td class="black">115</td>
            <td>    }
</td>
          </tr><tr>
            <td class="green">116</td>
            <td>    builder.result
</td>
          </tr><tr>
            <td class="black">117</td>
            <td>  }
</td>
          </tr><tr>
            <td class="black">118</td>
            <td>
</td>
          </tr><tr>
            <td class="black">119</td>
            <td>  /**Pesquisa um field da classe e superclasses reculsirvamente
</td>
          </tr><tr>
            <td class="black">120</td>
            <td>   *
</td>
          </tr><tr>
            <td class="black">121</td>
            <td>   * @param o nome do field
</td>
          </tr><tr>
            <td class="black">122</td>
            <td>   * @param a classe da entidade
</td>
          </tr><tr>
            <td class="black">123</td>
            <td>   *
</td>
          </tr><tr>
            <td class="black">124</td>
            <td>   */
</td>
          </tr><tr>
            <td class="black">125</td>
            <td>  def findField[T](name: String, entityClass: Class[T]): Field = {
</td>
          </tr><tr>
            <td class="black">126</td>
            <td>    try {
</td>
          </tr><tr>
            <td class="green">127</td>
            <td>      entityClass.getDeclaredField(name)
</td>
          </tr><tr>
            <td class="black">128</td>
            <td>    } catch {
</td>
          </tr><tr>
            <td class="black">129</td>
            <td>      case e: java.lang.NoSuchFieldException =&gt;
</td>
          </tr><tr>
            <td class="green">130</td>
            <td>        entityClass.getSuperclass match {
</td>
          </tr><tr>
            <td class="black">131</td>
            <td>          case x: Class[T] =&gt;
</td>
          </tr><tr>
            <td class="green">132</td>
            <td>            findField(name, entityClass.getSuperclass)
</td>
          </tr><tr>
            <td class="black">133</td>
            <td>          case _ =&gt;
</td>
          </tr><tr>
            <td class="green">134</td>
            <td>            throw new RuntimeException(&quot;field not found: &quot; + entityClass.getName + &quot;[&quot; + name + &quot;]&quot;)
</td>
          </tr><tr>
            <td class="black">135</td>
            <td>        }
</td>
          </tr><tr>
            <td class="black">136</td>
            <td>
</td>
          </tr><tr>
            <td class="black">137</td>
            <td>    }
</td>
          </tr><tr>
            <td class="black">138</td>
            <td>  }
</td>
          </tr><tr>
            <td class="black">139</td>
            <td>
</td>
          </tr><tr>
            <td class="black">140</td>
            <td>  /**Carrega os fields da classe e superclasses recusivamente
</td>
          </tr><tr>
            <td class="black">141</td>
            <td>   *
</td>
          </tr><tr>
            <td class="black">142</td>
            <td>   * @param a classe
</td>
          </tr><tr>
            <td class="black">143</td>
            <td>   *
</td>
          </tr><tr>
            <td class="black">144</td>
            <td>   */
</td>
          </tr><tr>
            <td class="black">145</td>
            <td>  def loadFieldsRecursively[T](entityClass: Class[T]): List[Field] = {
</td>
          </tr><tr>
            <td class="green">146</td>
            <td>    loadFieldsRecursively(entityClass, List.empty[Field])
</td>
          </tr><tr>
            <td class="black">147</td>
            <td>  }
</td>
          </tr><tr>
            <td class="black">148</td>
            <td>
</td>
          </tr><tr>
            <td class="black">149</td>
            <td>  /**Carrega os fields da classe e superclasses recusivamente
</td>
          </tr><tr>
            <td class="black">150</td>
            <td>   *
</td>
          </tr><tr>
            <td class="black">151</td>
            <td>   * @param a classe
</td>
          </tr><tr>
            <td class="black">152</td>
            <td>   * @param a lista de fields
</td>
          </tr><tr>
            <td class="black">153</td>
            <td>   *
</td>
          </tr><tr>
            <td class="black">154</td>
            <td>   */
</td>
          </tr><tr>
            <td class="black">155</td>
            <td>  def loadFieldsRecursively[T](entityClass: Class[T], fieldList: List[Field]): List[Field] = {
</td>
          </tr><tr>
            <td class="green">156</td>
            <td>    entityClass match {
</td>
          </tr><tr>
            <td class="black">157</td>
            <td>      case c: Class[T] =&gt;
</td>
          </tr><tr>
            <td class="green">158</td>
            <td>        loadFieldsRecursively(entityClass.getSuperclass, fieldList union c.getDeclaredFields.toList)
</td>
          </tr><tr>
            <td class="black">159</td>
            <td>      case _ =&gt;
</td>
          </tr><tr>
            <td class="green">160</td>
            <td>        fieldList
</td>
          </tr><tr>
            <td class="black">161</td>
            <td>    }
</td>
          </tr><tr>
            <td class="black">162</td>
            <td>  }
</td>
          </tr><tr>
            <td class="black">163</td>
            <td>
</td>
          </tr><tr>
            <td class="black">164</td>
            <td>  /**
</td>
          </tr><tr>
            <td class="black">165</td>
            <td>   * Valida os fields persistentes
</td>
          </tr><tr>
            <td class="black">166</td>
            <td>   *
</td>
          </tr><tr>
            <td class="black">167</td>
            <td>   * @param entity, a entidade em questão
</td>
          </tr><tr>
            <td class="black">168</td>
            <td>   * @param o field a ser validado
</td>
          </tr><tr>
            <td class="black">169</td>
            <td>   * @return true caso o field atenda os critérios para serem persistidos
</td>
          </tr><tr>
            <td class="black">170</td>
            <td>   */
</td>
          </tr><tr>
            <td class="black">171</td>
            <td>  def validatePersistenteField[T &lt;: Entity](entity: T, field: Field): Boolean = {
</td>
          </tr><tr>
            <td class="green">172</td>
            <td>    !entity.getTransientFields.contains(field.getName) &amp;&amp; !field.getName.equals(&quot;transientFields&quot;)
</td>
          </tr><tr>
            <td class="black">173</td>
            <td>  }
</td>
          </tr><tr>
            <td class="black">174</td>
            <td>
</td>
          </tr><tr>
            <td class="black">175</td>
            <td>}
</td>
          </tr></tbody></table>